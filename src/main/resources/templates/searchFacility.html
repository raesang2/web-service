<!DOCTYPE html>
<html lang="ko">
<head>
    <th:block th:replace="~{common.html}"></th:block>
    <meta property="og:type" content="website"> 
    <meta property="og:title" content="ìš°ìˆ˜ ì–´ë¦°ì´ë†€ì´ì‹œì„¤ ê²€ìƒ‰"> 
    <meta property="og:description" content="ìš°ìˆ˜ ì–´ë¦°ì´ë†€ì´ì‹œì„¤ì„ ê²€ìƒ‰í•´ë³´ì„¸ìš”">
    <meta property="og:url" content="https://kkidsname.com/searchFacility">
    <meta charset="UTF-8">
    <title>ìš°ìˆ˜ ì–´ë¦°ì´ë†€ì´ì‹œì„¤ ê²€ìƒ‰</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
	<div class="container">
	<div class="top-bar">
	    <div class="top-left" th:replace="~{nav.html}"></div>
	    <div class="top-center" th:replace="~{titlebar.html :: title-bar(centerClass='search-title', titleText='ìš°ìˆ˜ ì–´ë¦°ì´ë†€ì´ì‹œì„¤ ê²€ìƒ‰')}"></div>
	    <div class="top-right"></div> <!-- ì¶”í›„ ë²„íŠ¼ ë“± ìœ„ì¹˜ìš© -->
	</div>

    <div id="notice">
        ì•ˆì „ì€ ê¸°ë³¸! ì°½ì˜ë ¥ë„ ê¸¸ëŸ¬ì£¼ëŠ” <a href="https://www2.korea.kr/briefing/pressReleaseView.do?newsId=156664884&pWise=sub&pWiseSub=J1" target="_blank">ìš°ìˆ˜ ì–´ë¦°ì´ë†€ì´ì‹œì„¤</a><br><br>
        í–‰ì •ì•ˆì „ë¶€ì—ì„œ ë§¤ë…„ ì„ ì •(ìœ íš¨ê¸°ê°„ 3ë…„)<br><br>
        ë°ì´í„° ì¶œì²˜ : <a href="https://www.data.go.kr/data/15124527/openapi.do" target="_blank">í–‰ì •ì•ˆì „ë¶€_ì „êµ­ì–´ë¦°ì´ë†€ì´ì‹œì„¤ìš°ìˆ˜ì‹œì„¤ì •ë³´ì„œë¹„ìŠ¤</a>
    </div>
    <form id="searchForm">
        <div class="form-group">
            <label for="regionName">ì§€ì—­ëª…</label>
            <input type="text" id="regionName" name="regionName" placeholder="ì˜ˆ: ì„œìš¸, ëŒ€ì „ ë“±" class="regionSearchName">
            <input type="submit" value="ê²€ìƒ‰">
        </div>
    </form>

    <div id="facility-result-summary"></div>
    <div id="facility-result-table"></div>
    <!-- <div id="pagination"></div>  -->

</div>



<!-- ì§€ë„ ëª¨ë‹¬ -->
<div id="mapModal">
<div style="padding: 10px;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2 id="modalTitle" style="margin: 0;">ì§€ë„ ì œëª©</h2>
        <span onclick="closeModal()" style="cursor:pointer; font-size:24px;">&times;</span>
    </div>    
    <div style="display: flex; align-items: center; margin-top: 8px;">
        <h4 id="modalAddress" style="margin: 0; color: gray; font-weight: normal;"></h4>
        <button onclick="copyAddress()" title="ì£¼ì†Œ ë³µì‚¬" style="margin-left: 8px; background: none; border: none; cursor: pointer;">
            ğŸ“‹
        </button>
    </div>
</div>
    <div id="naverMap" style="width:100%; height:80%;"></div>
</div>

<script>
function showMapInModal(lat, lng, ftitle) {
    document.getElementById("mapModal").style.display = "block";
    document.getElementById("modalTitle").innerText = ftitle;
    document.getElementById("modalAddress").innerText = "ì£¼ì†Œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";

    // ì§€ë„ ìƒì„±
    const map = new naver.maps.Map('naverMap', {
        center: new naver.maps.LatLng(lat, lng),
        zoom: 16
    });

    // ë§ˆì»¤ ìƒì„±
    const marker = new naver.maps.Marker({
        position: new naver.maps.LatLng(lat, lng),
        map: map
    });

    // ì—­ì§€ì˜¤ì½”ë”©ìœ¼ë¡œ ì£¼ì†Œ ì–»ê¸°
    naver.maps.Service.reverseGeocode({
        coords: new naver.maps.LatLng(lat, lng),
        orders: 'roadaddr,addr'
    }, function(status, response) {
        if (status !== naver.maps.Service.Status.OK || !response.v2 || !response.v2.address) {
            document.getElementById("modalAddress").innerText = "ì£¼ì†Œë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
            return;
        }

        const roadAddress = response.v2.address.roadAddress || response.v2.address.jibunAddress || "ì£¼ì†Œ ì—†ìŒ";
        document.getElementById("modalAddress").innerText = roadAddress;

        // ì£¼ì†Œë¡œ ì§€ë„ ê²€ìƒ‰ ë§í¬ ì´ë™
        naver.maps.Event.addListener(marker, 'click', function () {
            const searchUrl = "https://map.naver.com/p/search/" + encodeURIComponent(roadAddress);
            window.open(searchUrl, '_blank');
        });
    });
}

function closeModal() {
    document.getElementById("mapModal").style.display = "none";
}

document.addEventListener('DOMContentLoaded', function () {
    let currentPage = 1;
    loadResults();
    document.getElementById('searchForm').addEventListener('submit', function (event) {
        event.preventDefault();
        currentPage = 1;
        loadResults();
    });

    window.loadPage = function(page) {
        currentPage = page;
        loadResults();
    }

    function loadResults() {
        const region = document.getElementById('regionName').value;
        fetch(`/facilityList?regionName=${encodeURIComponent(region)}&page=${currentPage}`)
            .then(response => response.text())
            .then(html => {
                document.getElementById('facility-result-table').innerHTML = html;

                // ê²°ê³¼ ê°œìˆ˜ ì¶”ì¶œ
                const totalCount = document.getElementById('totalCount').value;
				const totalPages = document.getElementById('totalPages').value;

                document.getElementById('facility-result-summary').innerHTML = `<h3>ì´ <strong>${totalCount}</strong>ê°œì˜ ì‹œì„¤ì´ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤.</h3>`;

                // í˜ì´ì§€ ìˆ˜
                //let pageHtml = '';
                //for (let i = 1; i <= totalPages; i++) {
                //    pageHtml += `<button onclick="loadPage(${i})">${i}</button> `;
                //}
                //document.getElementById('pagination').innerHTML = pageHtml;
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }
});

function copyAddress() {
    const address = document.getElementById("modalAddress").innerText;
    navigator.clipboard.writeText(address).then(() => {
        alert("ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }).catch(err => {
        console.error("ë³µì‚¬ ì‹¤íŒ¨:", err);
    });
}
</script>
</body>
</html>
